/**
 *  Script to format and display imported data 
 *  By Nick Mullen
 *  date 21/02/2018
 **/

try {
  	//Only work if published
	if(content.getStatus().toString() == 0){  
      
      importClass(com.terminalfour.navigation.ServerSideLinkManager);
      importClass(com.terminalfour.publish.utils.TreeTraversalUtils);
      importClass(com.terminalfour.spring.ApplicationContextProvider);
      importClass(com.terminalfour.publish.utils.BrokerUtils); 
      importClass(com.terminalfour.publish.PathBuilder);
      importClass(com.terminalfour.sitemanager.ContentHierarchy);

     // var cmgr            = com.terminalfour.content.IContentManager;
      var cmgr            = ApplicationContextProvider.getBean(com.terminalfour.content.IContentManager);
      var channel         = publishCache.getChannel();
      var oCH			  = new ContentHierarchy();
      var oConn           = dbStatement.getConnection(); // db connection
      var mySSLManager    = ServerSideLinkManager.getManager();
      var sectionElement  = content.get('SectionContent');   
      var myLink          = mySSLManager.getLink(oConn,sectionElement.getValue(),section.getID(),content.getID(),language);
      var targetSectionId = myLink.getToSectionID();
      var targetSection   = TreeTraversalUtils.findSection (channel, section, targetSectionId, language);
      var myTemplateID    = 86;  //id of the template type used to import the data
      var myKeyword       = content.get('Keyword').toString();   // get the keyword
      var formatter       = content.get('Layout').publish().toString();// get the formater
      var allContentInSection = oCH.getContent(dbStatement,targetSectionId,'en'); // get all content from target section
	
	 
      for (var i = 0; i < allContentInSection.length; i++) {
          var thisContent = cmgr.get(allContentInSection[i],language)
          var thisTemplateID = thisContent.getContentTypeID().toString();
          // only process import data content types
          if(thisTemplateID == myTemplateID){          		
              var thisKeyword = thisContent.get('keyword').toString();    
              var thisStatus  = thisContent.getStatus().toString();
			  // If content is published and keyword is found display output
              if((isKeyword(thisKeyword,myKeyword))&&(thisStatus == 0)){
                  var tempManager   = com.terminalfour.template.TemplateManager.getManager();
                  var format        = tempManager.getFormat(dbStatement,myTemplateID,formatter);
                  var formatString  = format.getFormatting(); 
                  var outputContent = BrokerUtils.processT4Tags(dbStatement, publishCache, targetSection, thisContent, language, isPreview, formatString); 
                  // convert to markdown if selected
                  if(formatter =='text/md'){    
                    	showdown_parser();
                    	markdown_array    = outputContent.split("<br />");
						markdown_joined   = markdown_array.join("\n");
                    	var converter     = new showdown.Converter();
						var text          = markdown_joined;
						var outputContent = converter.makeHtml(text);              
                	}                     
                document.write(outputContent);         
                                    
              }
          }
      }// end loop
	}// end outer if

} catch (err) {
	document.write(err);
}



/**
 * function to determine if the content contains a key word 
 * out boolean
 **/
function isKeyword(thisKeyword,myKeyword){            
  thisKeyword = thisKeyword.toLowerCase().trim();
  myKeyword= myKeyword.toLowerCase().trim();
  var str_array = thisKeyword.split(',');
  for(var i = 0; i < str_array.length; i++) {
    if(myKeyword.indexOf(str_array[i].trim()) != -1){
      return true;
    }
  }       
  return false;
}	

/**
 * function to Parse markdown
 * html out
 **/

function showdown_parser(){
  	 
/*! showdown 19-08-2016 */

(function(){function a(a){"use strict";var b={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Specify a prefix to generated header ids",type:"string"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,description:"Tries to smartly fix identation in es6 strings",type:"boolean"}};if(a===!1)return JSON.parse(JSON.stringify(b));var c={};for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d].defaultValue);return c}function g(a,c){"use strict";var d=c?"Error in "+c+" extension->":"Error in unnamed extension",e={valid:!0,error:""};b.helper.isArray(a)||(a=[a]);for(var f=0;f<a.length;++f){var g=d+" sub-extension "+f+": ",h=a[f];if("object"!=typeof h)return e.valid=!1,e.error=g+"must be an object, but "+typeof h+" given",e;if(!b.helper.isString(h.type))return e.valid=!1,e.error=g+'property "type" must be a string, but '+typeof h.type+" given",e;var i=h.type=h.type.toLowerCase();if("language"===i&&(i=h.type="lang"),"html"===i&&(i=h.type="output"),"lang"!==i&&"output"!==i&&"listener"!==i)return e.valid=!1,e.error=g+"type "+i+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',e;if("listener"===i){if(b.helper.isUndefined(h.listeners))return e.valid=!1,e.error=g+'. Extensions of type "listener" must have a property called "listeners"',e}else if(b.helper.isUndefined(h.filter)&&b.helper.isUndefined(h.regex))return e.valid=!1,e.error=g+i+' extensions must define either a "regex" property or a "filter" method',e;if(h.listeners){if("object"!=typeof h.listeners)return e.valid=!1,e.error=g+'"listeners" property must be an object but '+typeof h.listeners+" given",e;for(var j in h.listeners)if(h.listeners.hasOwnProperty(j)&&"function"!=typeof h.listeners[j])return e.valid=!1,e.error=g+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+j+" must be a function but "+typeof h.listeners[j]+" given",e}if(h.filter){if("function"!=typeof h.filter)return e.valid=!1,e.error=g+'"filter" must be a function, but '+typeof h.filter+" given",e}else if(h.regex){if(b.helper.isString(h.regex)&&(h.regex=new RegExp(h.regex,"g")),!h.regex instanceof RegExp)return e.valid=!1,e.error=g+'"regex" property must either be a string or a RegExp object, but '+typeof h.regex+" given",e;if(b.helper.isUndefined(h.replace))return e.valid=!1,e.error=g+'"regex" extensions must implement a replace string or function',e}}return e}function h(a,b){"use strict";var c=b.charCodeAt(0);return"~E"+c+"E"}var b={},c={},d={},e=a(!0),f={github:{omitExtraWLInCodeBlocks:!0,prefixHeaderId:"user-content-",simplifiedAutoLink:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0},vanilla:a(!0)};b.helper={},b.extensions={},b.setOption=function(a,b){"use strict";return e[a]=b,this},b.getOption=function(a){"use strict";return e[a]},b.getOptions=function(){"use strict";return e},b.resetOptions=function(){"use strict";e=a(!0)},b.setFlavor=function(a){"use strict";if(f.hasOwnProperty(a)){var b=f[a];for(var c in b)b.hasOwnProperty(c)&&(e[c]=b[c])}},b.getDefaultOptions=function(b){"use strict";return a(b)},b.subParser=function(a,d){"use strict";if(b.helper.isString(a)){if("undefined"==typeof d){if(c.hasOwnProperty(a))return c[a];throw Error("SubParser named "+a+" not registered!")}c[a]=d}},b.extension=function(a,c){"use strict";if(!b.helper.isString(a))throw Error("Extension 'name' must be a string");if(a=b.helper.stdExtName(a),b.helper.isUndefined(c)){if(!d.hasOwnProperty(a))throw Error("Extension named "+a+" is not registered!");return d[a]}"function"==typeof c&&(c=c()),b.helper.isArray(c)||(c=[c]);var e=g(c,a);if(!e.valid)throw Error(e.error);d[a]=c},b.getAllExtensions=function(){"use strict";return d},b.removeExtension=function(a){"use strict";delete d[a]},b.resetExtensions=function(){"use strict";d={}},b.validateExtension=function(a){"use strict";var b=g(a,null);return!!b.valid},b.hasOwnProperty("helper")||(b.helper={}),b.helper.isString=function(b){"use strict";return"string"==typeof b||b instanceof String},b.helper.isFunction=function(b){"use strict";var c={};return b&&"[object Function]"===c.toString.call(b)},b.helper.forEach=function(b,c){"use strict";if("function"==typeof b.forEach)b.forEach(c);else for(var d=0;d<b.length;d++)c(b[d],d,b)},b.helper.isArray=function(b){"use strict";return b.constructor===Array},b.helper.isUndefined=function(b){"use strict";return"undefined"==typeof b},b.helper.stdExtName=function(a){"use strict";return a.replace(/[_-]||\s/g,"").toLowerCase()},b.helper.escapeCharactersCallback=h,b.helper.escapeCharacters=function(b,c,d){"use strict";var e="(["+c.replace(/([\[\]\\])/g,"\\$1")+"])";d&&(e="\\\\"+e);var f=new RegExp(e,"g");return b=b.replace(f,h)};var i=function(a,b,c,d){"use strict";var j,k,l,m,n,e=d||"",f=e.indexOf("g")>-1,g=new RegExp(b+"|"+c,"g"+e.replace(/g/g,"")),h=new RegExp(b,e.replace(/g/g,"")),i=[];do for(j=0;l=g.exec(a);)if(h.test(l[0]))j++||(k=g.lastIndex,m=k-l[0].length);else if(j&&!--j){n=l.index+l[0].length;var o={left:{start:m,end:k},match:{start:k,end:l.index},right:{start:l.index,end:n},wholeMatch:{start:m,end:n}};if(i.push(o),!f)return i}while(j&&(g.lastIndex=k));return i};b.helper.matchRecursiveRegExp=function(a,b,c,d){"use strict";for(var e=i(a,b,c,d),f=[],g=0;g<e.length;++g)f.push([a.slice(e[g].wholeMatch.start,e[g].wholeMatch.end),a.slice(e[g].match.start,e[g].match.end),a.slice(e[g].left.start,e[g].left.end),a.slice(e[g].right.start,e[g].right.end)]);return f},b.helper.replaceRecursiveRegExp=function(a,c,d,e,f){"use strict";if(!b.helper.isFunction(c)){var g=c;c=function(){return g}}var h=i(a,d,e,f),j=a,k=h.length;if(k>0){var l=[];0!==h[0].wholeMatch.start&&l.push(a.slice(0,h[0].wholeMatch.start));for(var m=0;m<k;++m)l.push(c(a.slice(h[m].wholeMatch.start,h[m].wholeMatch.end),a.slice(h[m].match.start,h[m].match.end),a.slice(h[m].left.start,h[m].left.end),a.slice(h[m].right.start,h[m].right.end))),m<k-1&&l.push(a.slice(h[m].wholeMatch.end,h[m+1].wholeMatch.start));h[k-1].wholeMatch.end<a.length&&l.push(a.slice(h[k-1].wholeMatch.end)),j=l.join("")}return j},b.Converter=function(a){"use strict";function k(){a=a||{};for(var d in e)e.hasOwnProperty(d)&&(c[d]=e[d]);if("object"!=typeof a)throw Error("Converter expects the passed parameter to be an object, but "+typeof a+" was passed instead.");for(var f in a)a.hasOwnProperty(f)&&(c[f]=a[f]);c.extensions&&b.helper.forEach(c.extensions,l)}function l(a,c){if(c=c||null,b.helper.isString(a)){if(a=b.helper.stdExtName(a),c=a,b.extensions[a])return;if(b.helper.isUndefined(d[a]))throw Error('Extension "'+a+'" could not be loaded. It was either not found or is not a valid extension.');a=d[a]}"function"==typeof a&&(a=a()),b.helper.isArray(a)||(a=[a]);var e=g(a,c);if(!e.valid)throw Error(e.error);for(var f=0;f<a.length;++f){switch(a[f].type){case"lang":h.push(a[f]);break;case"output":i.push(a[f])}if(a[f].hasOwnProperty(j))for(var k in a[f].listeners)a[f].listeners.hasOwnProperty(k)&&n(k,a[f].listeners[k])}}function n(a,c){if(!b.helper.isString(a))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof a+" given");if("function"!=typeof c)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof c+" given");j.hasOwnProperty(a)||(j[a]=[]),j[a].push(c)}function o(a){var b=a.match(/^\s*/)[0].length,c=new RegExp("^\\s{0,"+b+"}","gm");return a.replace(c,"")}var c={},h=[],i=[],j={};k(),this._dispatch=function(b,c,d,e){if(j.hasOwnProperty(b))for(var f=0;f<j[b].length;++f){var g=j[b][f](b,c,this,d,e);g&&"undefined"!=typeof g&&(c=g)}return c},this.listen=function(a,b){return n(a,b),this},this.makeHtml=function(a){if(!a)return a;var d={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:h,outputModifiers:i,converter:this,ghCodeBlocks:[]};return a=a.replace(/~/g,"~T"),a=a.replace(/\$/g,"~D"),a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),c.smartIndentationFix&&(a=o(a)),a="\n\n"+a+"\n\n",a=b.subParser("detab")(a,c,d),a=b.subParser("stripBlankLines")(a,c,d),b.helper.forEach(h,function(e){a=b.subParser("runExtension")(e,a,c,d)}),a=b.subParser("hashPreCodeTags")(a,c,d),a=b.subParser("githubCodeBlocks")(a,c,d),a=b.subParser("hashHTMLBlocks")(a,c,d),a=b.subParser("hashHTMLSpans")(a,c,d),a=b.subParser("stripLinkDefinitions")(a,c,d),a=b.subParser("blockGamut")(a,c,d),a=b.subParser("unhashHTMLSpans")(a,c,d),a=b.subParser("unescapeSpecialChars")(a,c,d),a=a.replace(/~D/g,"$$"),a=a.replace(/~T/g,"~"),b.helper.forEach(i,function(e){a=b.subParser("runExtension")(e,a,c,d)}),a},this.setOption=function(a,b){c[a]=b},this.getOption=function(a){return c[a]},this.getOptions=function(){return c},this.addExtension=function(a,b){b=b||null,l(a,b)},this.useExtension=function(a){l(a)},this.setFlavor=function(a){if(f.hasOwnProperty(a)){var b=f[a];for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])}},this.removeExtension=function(a){b.helper.isArray(a)||(a=[a]);for(var c=0;c<a.length;++c){for(var d=a[c],e=0;e<h.length;++e)h[e]===d&&h[e].splice(e,1);for(var f=0;f<i.length;++e)i[f]===d&&i[f].splice(e,1)}},this.getAllExtensions=function(){return{language:h,output:i}}},b.subParser("anchors",function(a,c,d){"use strict";a=d.converter._dispatch("anchors.before",a,c,d);var e=function(a,c,e,f,g,h,i,j){b.helper.isUndefined(j)&&(j=""),a=c;var k=e,l=f.toLowerCase(),m=g,n=j;if(!m)if(l||(l=k.toLowerCase().replace(/ ?\n/g," ")),m="#"+l,b.helper.isUndefined(d.gUrls[l])){if(!(a.search(/\(\s*\)$/m)>-1))return a;m=""}else m=d.gUrls[l],b.helper.isUndefined(d.gTitles[l])||(n=d.gTitles[l]);m=b.helper.escapeCharacters(m,"*_",!1);var o='<a href="'+m+'"';return""!==n&&null!==n&&(n=n.replace(/"/g,"&quot;"),n=b.helper.escapeCharacters(n,"*_",!1),o+=' title="'+n+'"'),o+=">"+k+"</a>"};return a=a.replace(/(\[((?:\[[^\]]*]|[^\[\]])*)][ ]?(?:\n[ ]*)?\[(.*?)])()()()()/g,e),a=a.replace(/(\[((?:\[[^\]]*]|[^\[\]])*)]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,e),a=a.replace(/(\[([^\[\]]+)])()()()()()/g,e),a=d.converter._dispatch("anchors.after",a,c,d)}),b.subParser("autoLinks",function(a,c,d){"use strict";function i(a,b){var c=b;return/^www\./i.test(b)&&(b=b.replace(/^www\./i,"http://www.")),'<a href="'+b+'">'+c+"</a>"}function j(a,c){var d=b.subParser("unescapeSpecialChars")(c);return b.subParser("encodeEmailAddress")(d)}a=d.converter._dispatch("autoLinks.before",a,c,d);var e=/\b(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+)(?=\s|$)(?!["<>])/gi,f=/<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)>/gi,g=/(?:^|[ \n\t])([A-Za-z0-9!#$%&'*+-\/=?^_`\{|}~\.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?:$|[ \n\t])/gi,h=/<(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi;return a=a.replace(f,i),a=a.replace(h,j),c.simplifiedAutoLink&&(a=a.replace(e,i),a=a.replace(g,j)),a=d.converter._dispatch("autoLinks.after",a,c,d)}),b.subParser("blockGamut",function(a,c,d){"use strict";a=d.converter._dispatch("blockGamut.before",a,c,d),a=b.subParser("blockQuotes")(a,c,d),a=b.subParser("headers")(a,c,d);var e=b.subParser("hashBlock")("<hr />",c,d);return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,e),a=a.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,e),a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,e),a=b.subParser("lists")(a,c,d),a=b.subParser("codeBlocks")(a,c,d),a=b.subParser("tables")(a,c,d),a=b.subParser("hashHTMLBlocks")(a,c,d),a=b.subParser("paragraphs")(a,c,d),a=d.converter._dispatch("blockGamut.after",a,c,d)}),b.subParser("blockQuotes",function(a,c,d){"use strict";return a=d.converter._dispatch("blockQuotes.before",a,c,d),a=a.replace(/((^[ \t]{0,3}>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,e){var f=e;return f=f.replace(/^[ \t]*>[ \t]?/gm,"~0"),f=f.replace(/~0/g,""),f=f.replace(/^[ \t]+$/gm,""),f=b.subParser("githubCodeBlocks")(f,c,d),f=b.subParser("blockGamut")(f,c,d),f=f.replace(/(^|\n)/g,"$1  "),f=f.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /gm,"~0"),c=c.replace(/~0/g,"")}),b.subParser("hashBlock")("<blockquote>\n"+f+"\n</blockquote>",c,d)}),a=d.converter._dispatch("blockQuotes.after",a,c,d)}),b.subParser("codeBlocks",function(a,c,d){"use strict";a=d.converter._dispatch("codeBlocks.before",a,c,d),a+="~0";var e=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g;return a=a.replace(e,function(a,e,f){var g=e,h=f,i="\n";return g=b.subParser("outdent")(g),g=b.subParser("encodeCode")(g),g=b.subParser("detab")(g),g=g.replace(/^\n+/g,""),g=g.replace(/\n+$/g,""),c.omitExtraWLInCodeBlocks&&(i=""),g="<pre><code>"+g+i+"</code></pre>",b.subParser("hashBlock")(g,c,d)+h}),a=a.replace(/~0/,""),a=d.converter._dispatch("codeBlocks.after",a,c,d)}),b.subParser("codeSpans",function(a,c,d){"use strict";return a=d.converter._dispatch("codeSpans.before",a,c,d),"undefined"==typeof a&&(a=""),a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,c,d,e){var f=e;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=b.subParser("encodeCode")(f),c+"<code>"+f+"</code>"}),a=d.converter._dispatch("codeSpans.after",a,c,d)}),b.subParser("detab",function(a){"use strict";return a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"~A~B"),a=a.replace(/~B(.+?)~A/g,function(a,b){for(var c=b,d=4-c.length%4,e=0;e<d;e++)c+=" ";return c}),a=a.replace(/~A/g,"    "),a=a.replace(/~B/g,"")}),b.subParser("encodeAmpsAndAngles",function(a){"use strict";return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;")}),b.subParser("encodeBackslashEscapes",function(a){"use strict";return a=a.replace(/\\(\\)/g,b.helper.escapeCharactersCallback),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,b.helper.escapeCharactersCallback)}),b.subParser("encodeCode",function(a){"use strict";return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=b.helper.escapeCharacters(a,"*_{}[]\\",!1)}),b.subParser("encodeEmailAddress",function(a){"use strict";var b=[function(a){return"&#"+a.charCodeAt(0)+";"},function(a){return"&#x"+a.charCodeAt(0).toString(16)+";"},function(a){return a}];return a="mailto:"+a,a=a.replace(/./g,function(a){if("@"===a)a=b[Math.floor(2*Math.random())](a);else if(":"!==a){var c=Math.random();a=c>.9?b[2](a):c>.45?b[1](a):b[0](a)}return a}),a='<a href="'+a+'">'+a+"</a>",a=a.replace(/">.+:/g,'">')}),b.subParser("escapeSpecialCharsWithinTagAttributes",function(a){"use strict";var c=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return a=a.replace(c,function(a){var c=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return c=b.helper.escapeCharacters(c,"\\`*_",!1)})}),b.subParser("githubCodeBlocks",function(a,c,d){"use strict";return c.ghCodeBlocks?(a=d.converter._dispatch("githubCodeBlocks.before",a,c,d),a+="~0",a=a.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(a,e,f){var g=c.omitExtraWLInCodeBlocks?"":"\n";return f=b.subParser("encodeCode")(f),f=b.subParser("detab")(f),f=f.replace(/^\n+/g,""),f=f.replace(/\n+$/g,""),f="<pre><code"+(e?' class="'+e+" language-"+e+'"':"")+">"+f+g+"</code></pre>",f=b.subParser("hashBlock")(f,c,d),"\n\n~G"+(d.ghCodeBlocks.push({text:a,codeblock:f})-1)+"G\n\n"}),a=a.replace(/~0/,""),d.converter._dispatch("githubCodeBlocks.after",a,c,d)):a}),b.subParser("hashBlock",function(a,b,c){"use strict";return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(c.gHtmlBlocks.push(a)-1)+"K\n\n"}),b.subParser("hashElement",function(a,b,c){"use strict";return function(a,b){var d=b;return d=d.replace(/\n\n/g,"\n"),d=d.replace(/^\n/,""),d=d.replace(/\n+$/g,""),d="\n\n~K"+(c.gHtmlBlocks.push(d)-1)+"K\n\n"}}),b.subParser("hashHTMLBlocks",function(a,c,d){"use strict";for(var e=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],f=function(a,b,c,e){var f=a;return c.search(/\bmarkdown\b/)!==-1&&(f=c+d.converter.makeHtml(b)+e),"\n\n~K"+(d.gHtmlBlocks.push(f)-1)+"K\n\n"},g=0;g<e.length;++g)a=b.helper.replaceRecursiveRegExp(a,f,"^(?: |\\t){0,3}<"+e[g]+"\\b[^>]*>","</"+e[g]+">","gim");return a=a.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,b.subParser("hashElement")(a,c,d)),a=a.replace(/(<!--[\s\S]*?-->)/g,b.subParser("hashElement")(a,c,d)),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,b.subParser("hashElement")(a,c,d))}),b.subParser("hashHTMLSpans",function(a,c,d){"use strict";for(var e=b.helper.matchRecursiveRegExp(a,"<code\\b[^>]*>","</code>","gi"),f=0;f<e.length;++f)a=a.replace(e[f][0],"~L"+(d.gHtmlSpans.push(e[f][0])-1)+"L");return a}),b.subParser("unhashHTMLSpans",function(a,b,c){"use strict";for(var d=0;d<c.gHtmlSpans.length;++d)a=a.replace("~L"+d+"L",c.gHtmlSpans[d]);return a}),b.subParser("hashPreCodeTags",function(a,c,d){"use strict";var e=function(a,c,e,f){var g=e+b.subParser("encodeCode")(c)+f;return"\n\n~G"+(d.ghCodeBlocks.push({text:a,codeblock:g})-1)+"G\n\n"};return a=b.helper.replaceRecursiveRegExp(a,e,"^(?: |\\t){0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^(?: |\\t){0,3}</code>\\s*</pre>","gim")}),b.subParser("headers",function(a,c,d){"use strict";function i(a){var c,f=a.replace(/[^\w]/g,"").toLowerCase();return d.hashLinkCounts[f]?c=f+"-"+d.hashLinkCounts[f]++:(c=f,d.hashLinkCounts[f]=1),e===!0&&(e="section"),b.helper.isString(e)?e+c:c}a=d.converter._dispatch("headers.before",a,c,d);var e=c.prefixHeaderId,f=isNaN(parseInt(c.headerLevelStart))?1:parseInt(c.headerLevelStart),g=c.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,h=c.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;return a=a.replace(g,function(a,e){var g=b.subParser("spanGamut")(e,c,d),h=c.noHeaderId?"":' id="'+i(e)+'"',j=f,k="<h"+j+h+">"+g+"</h"+j+">";return b.subParser("hashBlock")(k,c,d)}),a=a.replace(h,function(a,e){var g=b.subParser("spanGamut")(e,c,d),h=c.noHeaderId?"":' id="'+i(e)+'"',j=f+1,k="<h"+j+h+">"+g+"</h"+j+">";return b.subParser("hashBlock")(k,c,d)}),a=a.replace(/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm,function(a,e,g){var h=b.subParser("spanGamut")(g,c,d),j=c.noHeaderId?"":' id="'+i(g)+'"',k=f-1+e.length,l="<h"+k+j+">"+h+"</h"+k+">";return b.subParser("hashBlock")(l,c,d)}),a=d.converter._dispatch("headers.after",a,c,d)}),b.subParser("images",function(a,c,d){"use strict";function g(a,c,e,f,g,h,i,j){var k=d.gUrls,l=d.gTitles,m=d.gDimensions;if(e=e.toLowerCase(),j||(j=""),""===f||null===f){if(""!==e&&null!==e||(e=c.toLowerCase().replace(/ ?\n/g," ")),f="#"+e,b.helper.isUndefined(k[e]))return a;f=k[e],b.helper.isUndefined(l[e])||(j=l[e]),b.helper.isUndefined(m[e])||(g=m[e].width,h=m[e].height)}c=c.replace(/"/g,"&quot;"),c=b.helper.escapeCharacters(c,"*_",!1),f=b.helper.escapeCharacters(f,"*_",!1);var n='<img src="'+f+'" alt="'+c+'"';return j&&(j=j.replace(/"/g,"&quot;"),j=b.helper.escapeCharacters(j,"*_",!1),n+=' title="'+j+'"'),g&&h&&(g="*"===g?"auto":g,h="*"===h?"auto":h,n+=' width="'+g+'"',n+=' height="'+h+'"'),n+=" />"}a=d.converter._dispatch("images.before",a,c,d);var e=/!\[(.*?)]\s?\([ \t]*()<?(\S+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(['"])(.*?)\6[ \t]*)?\)/g,f=/!\[([^\]]*?)] ?(?:\n *)?\[(.*?)]()()()()()/g;return a=a.replace(f,g),a=a.replace(e,g),a=d.converter._dispatch("images.after",a,c,d)}),b.subParser("italicsAndBold",function(a,b,c){"use strict";return a=c.converter._dispatch("italicsAndBold.before",a,b,c),b.literalMidWordUnderscores?(a=a.replace(/(^|\s|>|\b)__(?=\S)([\s\S]+?)__(?=\b|<|\s|$)/gm,"$1<strong>$2</strong>"),a=a.replace(/(^|\s|>|\b)_(?=\S)([\s\S]+?)_(?=\b|<|\s|$)/gm,"$1<em>$2</em>"),a=a.replace(/(\*\*)(?=\S)([^\r]*?\S[*]*)\1/g,"<strong>$2</strong>"),a=a.replace(/(\*)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")):(a=a.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),a=a.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")),a=c.converter._dispatch("italicsAndBold.after",a,b,c)}),b.subParser("lists",function(a,c,d){"use strict";function e(a,e){d.gListLevel++,a=a.replace(/\n{2,}$/,"\n"),a+="~0";var f=/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,g=/\n[ \t]*\n(?!~0)/.test(a);return a=a.replace(f,function(a,e,f,h,i,j,k){k=k&&""!==k.trim();var l=b.subParser("outdent")(i,c,d),m="";return j&&c.tasklists&&(m=' class="task-list-item" style="list-style-type: none;"',l=l.replace(/^[ \t]*\[(x|X| )?]/m,function(){var a='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return k&&(a+=" checked"),a+=">"})),e||l.search(/\n{2,}/)>-1?(l=b.subParser("githubCodeBlocks")(l,c,d),l=b.subParser("blockGamut")(l,c,d)):(l=b.subParser("lists")(l,c,d),l=l.replace(/\n$/,""),l=g?b.subParser("paragraphs")(l,c,d):b.subParser("spanGamut")(l,c,d)),l="\n<li"+m+">"+l+"</li>\n"}),a=a.replace(/~0/g,""),d.gListLevel--,e&&(a=a.replace(/\s+$/,"")),a}function f(a,b,c){var d="ul"===b?/^ {0,2}\d+\.[ \t]/gm:/^ {0,2}[*+-][ \t]/gm,f=[],g="";if(a.search(d)!==-1){!function a(f){var h=f.search(d);h!==-1?(g+="\n\n<"+b+">"+e(f.slice(0,h),!!c)+"</"+b+">\n\n",b="ul"===b?"ol":"ul",d="ul"===b?/^ {0,2}\d+\.[ \t]/gm:/^ {0,2}[*+-][ \t]/gm,a(f.slice(h))):g+="\n\n<"+b+">"+e(f,!!c)+"</"+b+">\n\n"}(a);for(var h=0;h<f.length;++h);}else g="\n\n<"+b+">"+e(a,!!c)+"</"+b+">\n\n";return g}a=d.converter._dispatch("lists.before",a,c,d),a+="~0";var g=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return d.gListLevel?a=a.replace(g,function(a,b,c){var d=c.search(/[*+-]/g)>-1?"ul":"ol";return f(b,d,!0)}):(g=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,a=a.replace(g,function(a,b,c,d){var e=d.search(/[*+-]/g)>-1?"ul":"ol";return f(c,e)})),a=a.replace(/~0/,""),a=d.converter._dispatch("lists.after",a,c,d)}),b.subParser("outdent",function(a){"use strict";return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,"")}),b.subParser("paragraphs",function(a,c,d){"use strict";a=d.converter._dispatch("paragraphs.before",a,c,d),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");for(var e=a.split(/\n{2,}/g),f=[],g=e.length,h=0;h<g;h++){var i=e[h];i.search(/~(K|G)(\d+)\1/g)>=0?f.push(i):(i=b.subParser("spanGamut")(i,c,d),i=i.replace(/^([ \t]*)/g,"<p>"),i+="</p>",f.push(i))}for(g=f.length,h=0;h<g;h++){for(var j="",k=f[h],l=!1;k.search(/~(K|G)(\d+)\1/)>=0;){var m=RegExp.$1,n=RegExp.$2;j="K"===m?d.gHtmlBlocks[n]:l?b.subParser("encodeCode")(d.ghCodeBlocks[n].text):d.ghCodeBlocks[n].codeblock,j=j.replace(/\$/g,"$$$$"),k=k.replace(/(\n\n)?~(K|G)\d+\2(\n\n)?/,j),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(k)&&(l=!0)}f[h]=k}return a=f.join("\n\n"),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,""),d.converter._dispatch("paragraphs.after",a,c,d)}),b.subParser("runExtension",function(a,b,c,d){"use strict";if(a.filter)b=a.filter(b,d.converter,c);else if(a.regex){var e=a.regex;!e instanceof RegExp&&(e=new RegExp(e,"g")),b=b.replace(e,a.replace)}return b}),b.subParser("spanGamut",function(a,c,d){"use strict";return a=d.converter._dispatch("spanGamut.before",a,c,d),a=b.subParser("codeSpans")(a,c,d),a=b.subParser("escapeSpecialCharsWithinTagAttributes")(a,c,d),a=b.subParser("encodeBackslashEscapes")(a,c,d),a=b.subParser("images")(a,c,d),a=b.subParser("anchors")(a,c,d),a=b.subParser("autoLinks")(a,c,d),a=b.subParser("encodeAmpsAndAngles")(a,c,d),a=b.subParser("italicsAndBold")(a,c,d),a=b.subParser("strikethrough")(a,c,d),a=a.replace(/  +\n/g," <br />\n"),a=d.converter._dispatch("spanGamut.after",a,c,d)}),b.subParser("strikethrough",function(a,b,c){"use strict";return b.strikethrough&&(a=c.converter._dispatch("strikethrough.before",a,b,c),a=a.replace(/(?:~T){2}([\s\S]+?)(?:~T){2}/g,"<del>$1</del>"),a=c.converter._dispatch("strikethrough.after",a,b,c)),a}),b.subParser("stripBlankLines",function(a){"use strict";return a.replace(/^[ \t]+$/gm,"")}),b.subParser("stripLinkDefinitions",function(a,c,d){"use strict";var e=/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?(\S+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=~0))/gm;return a+="~0",a=a.replace(e,function(a,e,f,g,h,i,j){return e=e.toLowerCase(),d.gUrls[e]=b.subParser("encodeAmpsAndAngles")(f),i?i+j:(j&&(d.gTitles[e]=j.replace(/"|'/g,"&quot;")),c.parseImgDimensions&&g&&h&&(d.gDimensions[e]={width:g,height:h}),"")}),a=a.replace(/~0/,"")}),b.subParser("tables",function(a,c,d){"use strict";function f(a){return/^:[ \t]*--*$/.test(a)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(a)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(a)?' style="text-align:center;"':""}function g(a,e){var f="";return a=a.trim(),c.tableHeaderId&&(f=' id="'+a.replace(/ /g,"_").toLowerCase()+'"'),a=b.subParser("spanGamut")(a,c,d),"<th"+f+e+">"+a+"</th>\n"}function h(a,e){var f=b.subParser("spanGamut")(a,c,d);return"<td"+e+">"+f+"</td>\n"}function i(a,b){for(var c="<table>\n<thead>\n<tr>\n",d=a.length,e=0;e<d;++e)c+=a[e];for(c+="</tr>\n</thead>\n<tbody>\n",e=0;e<b.length;++e){c+="<tr>\n";for(var f=0;f<d;++f)c+=b[e][f];c+="</tr>\n"}return c+="</tbody>\n</table>\n"}if(!c.tables)return a;var e=/^[ \t]{0,3}\|?.+\|.+\n[ \t]{0,3}\|?[ \t]*:?[ \t]*(?:-|=){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:-|=){2,}[\s\S]+?(?:\n\n|~0)/gm;return a=d.converter._dispatch("tables.before",a,c,d),a=a.replace(e,function(a){var c,d=a.split("\n");for(c=0;c<d.length;++c)/^[ \t]{0,3}\|/.test(d[c])&&(d[c]=d[c].replace(/^[ \t]{0,3}\|/,"")),/\|[ \t]*$/.test(d[c])&&(d[c]=d[c].replace(/\|[ \t]*$/,""));var e=d[0].split("|").map(function(a){return a.trim()}),j=d[1].split("|").map(function(a){return a.trim()}),k=[],l=[],m=[],n=[];for(d.shift(),d.shift(),c=0;c<d.length;++c)""!==d[c].trim()&&k.push(d[c].split("|").map(function(a){return a.trim()}));if(e.length<j.length)return a;for(c=0;c<j.length;++c)m.push(f(j[c]));for(c=0;c<e.length;++c)b.helper.isUndefined(m[c])&&(m[c]=""),l.push(g(e[c],m[c]));for(c=0;c<k.length;++c){for(var o=[],p=0;p<l.length;++p)b.helper.isUndefined(k[c][p]),o.push(h(k[c][p],m[p]));n.push(o)}return i(l,n)}),a=d.converter._dispatch("tables.after",a,c,d)}),b.subParser("unescapeSpecialChars",function(a){"use strict";return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)})});var j=this;"undefined"!=typeof module&&module.exports?module.exports=b:"function"==typeof define&&define.amd?define(function(){"use strict";return b}):j.showdown=b}).call(this);
//# sourceMappingURL=showdown.min.js.map

};